"use strict";(self.webpackChunkhaithong_194=self.webpackChunkhaithong_194||[]).push([[9161],{3244:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/watchdog-f078466130a776b4db8d3f9abf182312.svg"},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var r=t(6540);const s={},i=r.createContext(s);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:n},e.children)}},9857:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"kernel/watchdog/watchdog","title":"Watchdog","description":"* Watchdog is a Hardware device arms to reset the machine if the machine does not send PING to watchdog after a period of time.","source":"@site/docs/kernel/watchdog/watchdog.md","sourceDirName":"kernel/watchdog","slug":"/kernel/watchdog/","permalink":"/docs/kernel/watchdog/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/kernel/watchdog/watchdog.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Preempt","permalink":"/docs/kernel/preempt/"},"next":{"title":"Docker Networking","permalink":"/docs/networking/docker_network/images/docker_network"}}');var s=t(4848),i=t(8453);const o={},c="Watchdog",d={},a=[];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"watchdog",children:"Watchdog"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Watchdog is a Hardware device arms to reset the machine if the machine does not send PING to watchdog after a period of time."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Watchdog holds a Counter Register"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Counter initialy is set to a value (e.g: 600 sec)"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Counter is decreased over time"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"If Counter = 0, Watchdog trigger machine to reboot"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"When machine send PING to Watchdog, Counter is reloaded (set back to 600 sec)"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"watchdog",src:t(3244).A+""})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"When watchdog kernel module is loaded, it will check if Watchdog device is running or not?"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["E.g:\r\n",(0,s.jsx)(n.a,{href:"https://github.com/torvalds/linux/blob/38fec10eb60d687e30c8c6b5420d86e8149f7557/drivers/watchdog/iTCO_wdt.c#L593",title:"/v6.14/drivers/watchdog/iTCO_wdt.c",children:"iTCO_wdt_probe"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C",children:"static int iTCO_wdt_probe(struct platform_device *pdev) {\r\n    ...\r\n\r\n    if (!iTCO_wdt_set_running(p)) {\r\n        /*\r\n        * If the watchdog was not running set NO_REBOOT now to\r\n        * prevent later reboots.\r\n        */\r\n        p->update_no_reboot_bit(p->no_reboot_priv, true);\r\n    }\r\n    \r\n    ...\r\n}\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Use PING from Kernel via: ",(0,s.jsx)(n.em,{children:"CONFIG_WATCHDOG_HANDLE_BOOT_ENABLED"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Some Linux distro will force to has Watchdog running after boot."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"So, it requires PING to keep the COUNTER away from zero"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"PING can come from process in UserSpace"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["OR, PING from KERNEL via ",(0,s.jsx)(n.em,{children:"CONFIG_WATCHDOG_HANDLE_BOOT_ENABLED"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The config get kernel to send ping to Watchdog after boot."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Kernel will stop send PING when UserSpace starts to send it's first PING."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);